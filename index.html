<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>outline2markdown - 多层级大纲转 Markdown 工具</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <link rel="icon" href="https://source.unsplash.com/48x48/?logo,app" />
  <meta name="description" content="将多层级无序列表大纲一键转换为 Markdown 格式，支持粘贴、上传、下载、复制，层级自定义，极致体验。">
  <style>
    body { background: linear-gradient(135deg, #f8fafc 0%, #e0e7ef 100%); }
    .fade-in { animation: fadeIn 1s; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
  </style>
</head>
<body class="min-h-screen flex flex-col font-sans fade-in">
  <header class="bg-white shadow-md py-4 px-6 flex items-center justify-between">
    <div class="flex items-center gap-3">
      <img src="https://source.unsplash.com/48x48/?notebook,logo" alt="logo" class="w-10 h-10 rounded-lg shadow">
      <span class="text-2xl font-bold text-gray-800 tracking-tight">outline2markdown</span>
    </div>
    <nav>
      <a href="https://01mvp.com" target="_blank" class="text-blue-600 hover:underline text-lg font-medium flex items-center gap-1"><i class="fa-solid fa-link"></i> 友情链接：01mvp.com</a>
    </nav>
  </header>
  <main class="flex-1 flex flex-col items-center justify-center px-4 py-8">
    <div class="w-full max-w-3xl bg-white rounded-2xl shadow-xl p-8 mt-8">
      <h1 class="text-3xl font-bold mb-2 text-gray-900">多层级大纲转 Markdown 工具</h1>
      <p class="text-gray-600 mb-6">粘贴、上传或输入你的多层级无序列表，一键转换为 Markdown 格式。支持自定义 Header 层级，支持复制/下载。<br>示例已自动填充，直接体验！</p>
      <div class="flex flex-col md:flex-row gap-4 mb-4">
        <textarea id="outline-input" rows="12" class="flex-1 border rounded-lg p-3 text-gray-800 focus:ring-2 focus:ring-blue-400 transition outline-none resize-y" placeholder="粘贴你的多层级无序列表...">- 1
    - 1.1
    - 1.2
        - 1.2.1
            - 1.2.1.1
        - 1.2.2
- 2
    - 2.1
        - 2.1.1
- 3
    - 3.1</textarea>
        <div class="flex flex-col gap-2 w-56">
          <label class="font-medium text-gray-700 mb-1">转换模式</label>
          <select id="conversion-mode" class="border rounded-lg p-2 text-gray-700 focus:ring-2 focus:ring-blue-400">
            <option value="manual">手动层级数</option>
            <option value="auto" selected>自动检测 (推荐)</option>
          </select>
          <div id="manual-controls">
            <label class="font-medium text-gray-700 mb-1 mt-2 block">转换为标题的层级数</label>
            <select id="header-count" class="border rounded-lg p-2 text-gray-700 focus:ring-2 focus:ring-blue-400 w-full">
              <option value="1">1 层</option>
              <option value="2" selected>2 层</option>
              <option value="3">3 层</option>
              <option value="4">4 层</option>
            </select>
          </div>
          <label class="font-medium text-gray-700 mt-2">标题级别整体偏移</label>
          <select id="header-offset" class="border rounded-lg p-2 text-gray-700 focus:ring-2 focus:ring-blue-400">
            <option value="0" selected>不偏移</option>
            <option value="1">全部+1级（H1→H2，H2→H3...）</option>
            <option value="2">全部+2级（H1→H3...）</option>
          </select>
          <label class="font-medium text-gray-700 mt-4">上传 txt/markdown</label>
          <input type="file" id="file-upload" accept=".txt,.md,.markdown" class="border rounded-lg p-2" />
          <button id="load-demo" class="mt-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg px-3 py-1 text-sm"><i class="fa-solid fa-rotate-right"></i> 恢复示例</button>
        </div>
      </div>
      <div class="flex gap-3 mb-4">
        <button id="convert-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold px-6 py-2 rounded-lg shadow transition flex items-center gap-2"><i class="fa-solid fa-arrow-right-arrow-left"></i> 一键转换</button>
        <button id="copy-btn" class="bg-green-500 hover:bg-green-600 text-white font-semibold px-4 py-2 rounded-lg shadow transition flex items-center gap-2"><i class="fa-solid fa-copy"></i> 复制结果</button>
        <button id="download-btn" class="bg-yellow-400 hover:bg-yellow-500 text-white font-semibold px-4 py-2 rounded-lg shadow transition flex items-center gap-2"><i class="fa-solid fa-download"></i> 下载 Markdown</button>
      </div>
      <div>
        <label class="font-medium text-gray-700">转换结果</label>
        <textarea id="markdown-output" rows="12" readonly class="w-full border rounded-lg p-3 text-gray-800 bg-gray-50 mt-2 focus:outline-none resize-y"></textarea>
      </div>
    </div>
    <footer class="mt-10 text-gray-500 text-sm text-center">
      <div>© 2024 outline2markdown | 由 <a href="https://01mvp.com" class="text-blue-600 hover:underline">01mvp.com</a> 友情支持</div>
    </footer>
  </main>
  <script src="outline-converter.js"></script>
  <script>
    // DOM Elements
    const outlineInput = document.getElementById('outline-input');
    const conversionModeEl = document.getElementById('conversion-mode');
    const manualControlsEl = document.getElementById('manual-controls');
    const headerCountEl = document.getElementById('header-count');
    const headerOffsetEl = document.getElementById('header-offset');
    const convertBtn = document.getElementById('convert-btn');
    const copyBtn = document.getElementById('copy-btn');
    const downloadBtn = document.getElementById('download-btn');
    const markdownOutput = document.getElementById('markdown-output');
    const fileUpload = document.getElementById('file-upload');
    const loadDemoBtn = document.getElementById('load-demo');

    // Default demo text
    const demoText = `- 1\n    - 1.1\n    - 1.2\n        - 1.2.1\n            - 1.2.1.1\n        - 1.2.2\n- 2\n    - 2.1\n        - 2.1.1\n- 3\n    - 3.1`;

    function convertAndDisplay() {
      const text = outlineInput.value;
      const mode = conversionModeEl.value;
      const offset = parseInt(headerOffsetEl.value, 10);
      let md = '';

      if (typeof outline2markdown !== 'function' || typeof outline2markdownAuto !== 'function') {
        console.error('Conversion function(s) not found. Check script loading.');
        markdownOutput.value = 'Error: Conversion function(s) not loaded.';
        return;
      }

      if (mode === 'auto') {
        manualControlsEl.classList.add('hidden');
        md = outline2markdownAuto(text, offset);
      } else { // manual
        manualControlsEl.classList.remove('hidden');
        const count = parseInt(headerCountEl.value, 10);
        md = outline2markdown(text, count, offset);
      }
      markdownOutput.value = md;
    }

    // Event Listeners
    conversionModeEl.addEventListener('change', () => {
      // Immediately toggle visibility and reconvert
      if (conversionModeEl.value === 'auto') {
        manualControlsEl.classList.add('hidden');
      } else {
        manualControlsEl.classList.remove('hidden');
      }
      convertAndDisplay(); 
    });
    convertBtn.addEventListener('click', convertAndDisplay);
    headerCountEl.addEventListener('change', convertAndDisplay);
    headerOffsetEl.addEventListener('change', convertAndDisplay);
    outlineInput.addEventListener('input', convertAndDisplay);

    loadDemoBtn.addEventListener('click', () => {
      outlineInput.value = demoText.replace(/\\n/g, '\n').replace(/\\t/g, '\t');
      convertAndDisplay();
    });

    fileUpload.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function(evt) {
        outlineInput.value = evt.target.result;
        convertAndDisplay();
      };
      reader.readAsText(file, 'UTF-8');
    });

    copyBtn.addEventListener('click', () => {
      markdownOutput.select();
      document.execCommand('copy');
      copyBtn.innerHTML = '<i class="fa-solid fa-check"></i> 已复制';
      setTimeout(() => copyBtn.innerHTML = '<i class="fa-solid fa-copy"></i> 复制结果', 1200);
    });

    downloadBtn.addEventListener('click', () => {
      const blob = new Blob([markdownOutput.value], { type: 'text/markdown;charset=utf-8' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'outline.md';
      document.body.appendChild(a);
      a.click();
      setTimeout(() => {
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      }, 100);
    });

    // Initial conversion on load
    window.addEventListener('load', () => {
        conversionModeEl.value = 'auto'; // Default to auto
        manualControlsEl.classList.add('hidden');
        loadDemoBtn.click(); // Load demo and convert
    });
  </script>
</body>
</html> 